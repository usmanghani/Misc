CLEAR
CLOS ALL
SET CONFIRM ON
SET STAT BAR ON
SET TALK OFF
SET EXACT OFF
SET CENTURY ON
ON ERROR DO ERRORHANDLER IN UTILITY
ON KEY LABEL ESCAPE DO GETOUT IN UTILITY
SET DELETE OFF
SET DECIMAL TO 2
SET BELL TO 1000,1
IF ISCOLOR()
DEFINE WINDOW INFORM AT 0,0 SIZE 30-2,125-2;
   SHADOW PANEL MINIMIZE FLOAT GROW;
   TITLE "** ATLAS DATA INPUT FORM **";
   FOOTER "DESIGNED BY: MUHAMMAD REHAN QADRI";
   FONT "MS SANS SERIF",8;
   COLOR RGB (,,255,192,192,192);
   FILL FILE SYS(5)+SYS(2003)+"\marb009.BMP"
ELSE
DEFINE WINDOW INFORM AT 0,0 SIZE 30-2,125-2;
   SHADOW PANEL MINIMIZE FLOAT GROW;
   TITLE "** ATLAS DATA INPUT FORM **";
   FOOTER "DESIGNED BY: MUHAMMAD REHAN QADRI";
   FONT "MS SANS SERIF",8;
   COLOR RGB (,,255,192,192,192)
ENDIF
   DO bell2
ACTIVATE WINDOW INFORM
MOVE WINDOW INFORM CENTER
STORE .F. TO ent,edt
STORE 0 TO m.last_rec
STORE 0 TO m.rec
USE loctest ORDER TAG sn
SCATTER MEMVAR BLANK
@ 1.846,12 SAY "GEOGRAPHICAL DATA INPUT FORM";
   FONT "arial",20 STYLE "bt" COLOR W
@ 1.692,12.2 SAY "GEOGRAPHICAL DATA INPUT FORM";
   FONT "arial",20 STYLE "bt" COLOR b
@ 5,2 TO 22,123  PEN 2,20 STYLE "16";
   COLOR RGB(128,128,128,,,)
@ 7,4 SAY "SERIAL NO:" FONT "TIMES NEW ROMAN",12 STYLE "BT"
@ 9.5,4 SAY "CITY:" FONT "TIMES NEW ROMAN",12 STYLE "BT"
@ 12,4 SAY "COUNTRY:" FONT "TIMES NEW ROMAN",12 STYLE "BT"
@ 14.5,4 SAY "LATITUDE (DEG.MIN) :" FONT "TIMES NEW ROMAN",12 STYLE "BT"
@ 14.5,65 SAY "LATITUDE DIRECTION:" FONT "TIMES NEW ROMAN",12 STYLE "BT"
@ 17,4 SAY "LONGITUDE (DEG.MIN) :" FONT "TIMES NEW ROMAN",12 STYLE "BT"
@ 17,65 SAY "LONGITUDE DIRECTION:" FONT "TIMES NEW ROMAN",12 STYLE "BT"
@ 19.5,4 SAY "G.M.T. DIFF (+,-,00:00:00) :" FONT "TIMES NEW ROMAN",12 STYLE "BT"
@ 19.5,65 SAY "TIME DIFFERENCE :" FONT "TIMES NEW ROMAN",12 STYLE "BT"

@ 7,48 GET m.sn PICTURE "99999" FUNC "K";
   WHEN flow();
   VALID srch_code();
   FONT "TIMES NEW ROMAN",12 STYLE "B";
   SIZE 1,5;
   COLOR ,RGB(,,,255,255,255)
SET ORDER TO TAG city
@ 9.5,48 GET m.city PICTURE "@!K" WHEN ent;
   FONT "MS SANS SERIF",12 STYLE "B";
   VALID SRCH_CITY();
   COLOR ,RGB(,,,255,255,255);
   MESSAGE "ENTER CITY NAME"

SET ORDER TO TAG sn
@ 12,48 GET m.country PICTURE "@!K" WHEN ent;
   FONT "MS SANS SERIF",12 STYLE "B";
   COLOR ,RGB(,,,255,255,255);
   MESSAGE "ENTER COUNTRY NAME"

@ 14.5,48 GET m.latitude;
   FUNC "K" WHEN ent;
   FONT "MS SANS SERIF",12 STYLE "B";
   COLOR ,RGB(,,,255,255,255);
   VALID NOT EMPTY (m.latitude);
   ERROR "EMPTY ENTRY IS NOT ACCEPTABLE";
   MESSAGE "ENTER LATITUDE OF THE LOCATION"

@ 14.5,105 GET m.la_dir WHEN ent;
   FUNC "M NORTH,SOUTH";
   FONT "MS SANS SERIF",12 STYLE "B";
   COLOR ,RGB(,,,255,255,255);
   SIZE 1,7;
   MESSAGE "ENTER LATITUDE DIRECTION [PRESS SPACE BAR TO GET OTHER VALUE]"

@ 17,48 GET m.longitude WHEN ent;
   FUNC "K";
   FONT "MS SANS SERIF",12 STYLE "B";
   COLOR ,RGB(,,,255,255,255);
   VALID NOT EMPTY (m.longitude);
   ERROR "EMPTY ENTRY IS NOT ACCEPTABLE";
   MESSAGE "ENTER LONGITUDE OF THE LOCATION"

@ 17,105 GET m.lo_dir WHEN ent;
   FUNC "M EAST,WEST";
   FONT "MS SANS SERIF",12 STYLE "B";
   COLOR ,RGB(,,,255,255,255);
   SIZE 1,7;
   MESSAGE "ENTER LONGITUDE DIRECTION [PRESS SPACE BAR TO GET OTHER VALUE]"

@ 19.5,48 GET m.green PICTURE "!99:99:99B" WHEN ent;
   FUNCTION "K";
   FONT "MS SANS SERIF",12 STYLE "B";
   COLOR ,RGB(,,,255,255,255);
   VALID NOT EMPTY (m.green);
   ERROR "EMPTY ENTRY IS NOT ACCEPTABLE [ENTER 00:00:00 IF THERE IS NO DIFFERENCE]";
   MESSAGE "USE 0 FOR NO CHARACTER [FORMAT +/-00:00:00] (VERY IMPORTANT TO NOTICE)"

@ 19.5,105 GET m.diff WHEN rayyan() AND .F.;
   FUNCTION "K";
   FONT "MS SANS SERIF",12 STYLE "B";
   COLOR ,RGB(,,,255,255,255)

@ 23,17 GET m.choice DEFAULT " " SIZE 2,1,2;
   FUNCTION "*HN \<NEW ;\<EDIT;\<DEL.;\<UNDEL.;\<SEARCH;NEX\<T;\<PREV.;E\<XIT";
   FONT "MS SANS SERIF",9 STYLE "BT";
   WHEN move_f();
   VALID chk_choice()

READ CYCLE
* FUNCTION DEFINATIONS
* FUNCTION MOVE_F

FUNCTION move_f
IF ent
   SHOW GET m.choice,1 PROMPT "\<SAVE"
   SHOW GET m.choice,2 DISABLE
   SHOW GET m.choice,3 DISABLE
   SHOW GET m.choice,4 DISABLE
   SHOW GET m.choice,5 DISABLE
   SHOW GET m.choice,6 DISABLE
   SHOW GET m.choice,7 DISABLE
   SHOW GET m.choice,8 PROMPT "\<CANCEL"
   STORE .F. TO ent
ELSE
   STORE .F. TO ent
ENDIF
RETURN .T.

*FUNCTION CHK_CHOICE
FUNCTION chk_choice
DO CASE
CASE m.choice="NEW"
   STORE 0 TO m.last_rec
   SCATTER MEMVAR BLANK
   SHOW GETS
   STORE .T. TO ent
   _CUROBJ=1
CASE m.choice="EDIT"
   STORE RECNO() TO m.last_rec
   COUNT ALL TO m.t_rec
   IF m.t_rec=0
      WAIT "DATA FILE IS EMPTY" WINDOW NOWAIT
   ELSE
      STORE .T. TO ent
      STORE .T. TO edt
      _CUROBJ=1
   ENDIF
CASE m.choice="NEXT"
   SET ORDER TO TAG city
   IF EOF()
      WAIT "LAST RECORD" WINDOW NOWAIT
      ?? CHR(7)
   ELSE
      SKIP
      IF EOF()
         WAIT "LAST RECORD" WINDOW NOWAIT
         ?? CHR(7)
      ELSE
         SCATTER MEMVAR
         SHOW GETS
         IF DELETED ()
            WAIT "*DELETED RECORD*" WIND NOWAIT
         ENDIF
      ENDIF
   ENDIF
   _CUROBJ=15
   SET ORDER TO TAG sn
CASE m.choice="PREV."
   SET ORDER TO TAG city
   IF BOF()
      WAIT "*FIRST RECORD*" WINDOW NOWAIT
      ?? CHR(7)
   ELSE
      SKIP -1
      IF BOF()
         WAIT "*FIRST RECORD*" WINDOW NOWAIT
         ?? CHR(7)
      ELSE
         SCATTER MEMVAR
         SHOW GETS
         IF DELETED()
            WAIT "*DELETED RECORD*" WIND NOWAIT
         ENDIF
      ENDIF
   ENDIF
   _CUROBJ=16
   SET ORDER TO TAG sn
CASE m.choice="SAVE"
   IF NOT edt
      APPEND BLANK
   ENDIF
   SHOW GET m.choice,1 PROMPT "\<NEW"
   SHOW GET m.choice,2 ENABLE
   SHOW GET m.choice,3 ENABLE
   SHOW GET m.choice,4 ENABLE
   SHOW GET m.choice,5 ENABLE
   SHOW GET m.choice,6 ENABLE
   SHOW GET m.choice,7 ENABLE
   SHOW GET m.choice,8 PROMPT "E\<XIT"
   GOTO m.sn
   GATHER MEMVAR
   STORE .F. TO ent,edt
CASE m.choice="CANCEL"
   DEFINE WINDOW allert AT 0,0 TO 12,50;
      SHADOW PANEL MINIMIZE FLOAT GROW;
      TITLE "** CANCELLATION OF THE RECORD **";
      FOOTER "DESIGNED BY: MUHAMMAD REHAN QADRI";
      FONT "MS SANS SERIF",8;
      COLOR RGB (,,,192,192,192)
   ACTIVATE WINDOW allert
   MOVE WINDOW allert CENTER
   ?? CHR(7)
   @ 1,5 SAY "ARE YOU SURE TO CANCEL" FONT "TIMES NEW ROMAN",14 STYLE "B"
   @ 4,10 GET yn DEFAULT 1 SIZE 2,8,8;
      FUNCTION "*H \<YES;\<NO";
      FONT "TIMES NEW ROMAN",14 STYLE "B"
   READ CYCLE
   IF yn=1
      SHOW GET m.choice,1 PROMPT "\<NEW"
      SHOW GET m.choice,2 ENABLE
      SHOW GET m.choice,3 ENABLE
      SHOW GET m.choice,4 ENABLE
      SHOW GET m.choice,5 ENABLE
      SHOW GET m.choice,6 ENABLE
      SHOW GET m.choice,7 ENABLE
      SHOW GET m.choice,8 PROMPT "E\<XIT"
      STORE .F. TO ent,edt
      SCATTER MEMVAR
      SHOW GETS
      STORE .F. TO ent, edt
   ENDIF
   DEAC WIND allert
   RELEASE WIND allert
CASE m.choice="DEL."
   DEFINE WINDOW allert AT 0,0 TO 18,70;
      SHADOW PANEL MINIMIZE FLOAT GROW;
      TITLE "** DELETION OF THE RECORD **";
      FOOTER "DESIGNED BY: MUHAMMAD REHAN QADRI";
      COLOR RGB (,,,192,192,192)
   ACTIVATE WINDOW allert
   MOVE WINDOW allert CENTER
   SET ORDER TO TAG city
   GOTO TOP
   @ 5,6 SAY "PRESS F2 TO SELECT LOCATION NAME" FONT;
      "TIMES NEW ROMAN",14 STYLE "BT" COLOR R+/
   @ 1,6 SAY "ENTER LOCATION NAME: ";
      FONT "TIMES NEW ROMAN",14 STYLE "BT";
      GET m.city WHEN disp_pop() PICTURE "@!K" FONT "TIMES NEW ROMAN",14 STYLE "B";
      VALID NOT EMPTY (m.city) AND SEEK(m.city);
      ERROR "PRESS F2 TO SELECT LOCATION NAME"
   READ
   @ 5,0 TO 8,90 CLEAR
   IF SEEK(city)
      SCATTER MEMVAR
      SHOW GETS
      @ 5,6 SAY "ARE YOU SURE TO DELETE?" FONT "TIMES NEW ROMAN",14 STYLE "BT"
      @ 9,12 GET m.sure DEFAULT 1 SIZE 2,6,6;
         FUNCTION "*H \<YES;\<NO";
         FONT "TIMES NEW ROMAN",14 STYLE "BT"
      READ CYCLE
      IF m.sure=1
         DELETE
      ENDIF
      DEACT WIND allert
      RELEA WIND allert
   ELSE
      DEACT WIND allert
      RELEA WIND allert
   ENDIF
   SET ORDER TO TAG sn
   _CUROBJ=12
CASE m.choice= "UNDEL."
   IF NOT DELETED()
      WAIT "RECORD IS NOT DELETED" WIND NOWAIT
      ?? CHR(7)
   ELSE
      RECALL
      WAIT "SUCCESSFULL COMPLETION" WINDOW NOWAIT
      ?? CHR (7)
   ENDIF
   _CUROBJ=13
CASE m.choice="SEARCH"
   DEFINE WINDOW allert AT 0,0 TO 10,80;
      SHADOW PANEL MINIMIZE FLOAT GROW;
      TITLE "** RECORD SEARCH **";
      FOOTER "DESIGNED BY: MUHAMMAD REHAN QADRI";
      COLOR RGB (,,,192,192,192)
   ACTIVATE WINDOW allert
   MOVE WINDOW allert CENTER
   STORE RECNO() TO m.last_rec
   SET ORDER TO TAG city
   @ 5,6 SAY "PRESS F2 TO SELECT LOCATION NAME" FONT;
      "TIMES NEW ROMAN",14 STYLE "BT" COLOR R+/
   @ 1,6 SAY "ENTER LOCATION NAME: ";
      FONT "TIMES NEW ROMAN",14 STYLE "BT";
      GET m.city WHEN disp_pop() PICTURE "@!K" FONT "TIMES NEW ROMAN",14 STYLE "B";
      VALID NOT EMPTY (m.city) AND SEEK(m.city);
      ERROR "PRESS F2 TO SELECT LOCATION NAME"
   READ
   @ 5,0 TO 8,90 CLEAR
   IF SEEK (m.city)
      SCATTER MEMVAR
      SHOW GETS
      WAIT "SUCCESSFULL COMPLETION" WIND NOWAIT
      ??CHR (7)
   ELSE
      ?? CHR(7)
      WAIT "UNSUCCESSFULL COMPLETION" WINDOW NOWAIT
      SCATTER MEMVAR
      SHOW GETS
   ENDIF
   DEAC WIND allert
   RELE WIND allert
   SET ORDER TO TAG sn
   _CUROBJ=14
CASE m.choice="DISP."
CASE m.choice="PRINT"
CASE m.choice="EXIT"
   DO BELL
   DEAC POPU city_list
   RELE POPU city_list
   DEAC WIND POPUP
   RELE WIND POPUP
   ON KEY
   DEACTIVATE WINDOW INFORM
   RELEASE WINDOWS INFORM
   SET EXACT ON
   SET DELE ON
   SET STAT BAR OFF
   CLEAR
   CLEAR WIND
   CLOSE ALL
ENDCASE
* FUNCTION SRCH_CODE
FUNCTION srch_code
DO CASE
CASE NOT edt
   IF EMPTY (m.sn) OR SEEK (m.sn)
      RETURN .F.
   ENDIF
CASE edt
   IF SEEK (m.sn)
      SCATTER MEMVAR
      SHOW GETS
   ELSE
      RETURN .F.
   ENDIF
ENDCASE
RETURN .T.

* FUNCTION SRCH_CITY
FUNCTION srch_cITY
SET ORDER TO TAG CITY
DO CASE
CASE NOT edt
   IF EMPTY (m.CITY) OR SEEK (m.CITY)
	  IF NOT DELETED()
	  WAIT WINDOW "ERROR: ENTRY IS EMPTY OR CITY INFORMATION ALREADY EXIST ON SERIAL NO."+ALLTRIM(STR(SN))
	  ENDIF
	  IF DELETED()
	  WAIT WINDOW "ERROR: ENTRY IS EMPTY OR CITY INFORMATION ALREADY EXIST ON SERIAL NO. "+ALLTRIM(STR(SN))+CHR(13)+"BUT THE RECORD IS DELETED"
	  ENDIF
      RETURN .F.
	  SET ORDER TO TAG SN
   ENDIF
CASE edt
   IF SEEK (m.CITY)
      SCATTER MEMVAR
      SHOW GETS
	  SET ORDER TO TAG SN
   ELSE
      RETURN .F.
	  SET ORDER TO TAG SN
   ENDIF
ENDCASE
RETURN .T.


PROCEDURE BELL
SET BELL TO 200,2
??CHR(7)
SET BELL TO 1200,1
??CHR(7)
SET BELL TO 1000,2
??CHR(7)
SET BELL TO 2200,2
??CHR(7)
RETURN

PROCEDURE bell1
SET BELL TO 800,2
??CHR(7)
SET BELL TO 5000,2
??CHR(7)
SET BELL TO 2000,2
??CHR(7)
RETURN

PROCEDURE bell2
SET BELL TO 2500,4
??CHR(7)
SET BELL TO 1500,4
??CHR(7)
SET BELL TO 2200,4
??CHR(7)
RETURN

FUNCTION flow
IF NOT edt
   CALC MAX(sn) TO A
   m.sn=A+1
   SHOW GET m.sn
   RETURN .F.
ENDIF

FUNCTION rayyan
IF ent
   zarab1=VAL(RIGHT(ALLTRIM(m.longitude),2))*4
   zarab2=VAL(LEFT(ALLTRIM(m.longitude),AT(".",ALLTRIM(m.longitude))-1))*4
   
   IF zarab1>=60 AND zarab1<120
      zarab2=zarab2+1
      zarab1=zarab1-60
   ENDIF
   
   IF zarab1>=120 AND zarab1<180
      zarab2=zarab2+2
      zarab1=zarab1-120
   ENDIF
   
   IF zarab1>=180 AND zarab1<240
      zarab2=zarab2+3
      zarab1=zarab1-180
   ENDIF
   
   int1= INT(zarab1)
   int2= INT(zarab2)
   hassec=int2*60+int1
   gmi=INT(VAL(SUBSTR(m.green,AT(":",m.green,1)+1,2)))
   ghr=INT(ABS(VAL(LEFT(m.green,AT(":",m.green,1)-1))))
   o= INT(VAL(ALLTRIM((RIGHT(m.green,2)))))
   gresec=(ghr*3600)+(gmi*60)+o
   taqsim=int2/60
   rem=-INT(taqsim)*60+int2
   hasil=ALLTRIM(STR(INT(taqsim)))+":"+ALLTRIM(STR(INT(rem)))+":"+ALLTRIM(STR(int1))
   IF gresec>hassec
      tadil=gresec-hassec
   ENDIF
   
   IF gresec<hassec
      tadil=hassec-gresec
   ENDIF
   
   IF GRESEC=HASSEC
      TADIL=0
   ENDIF
   taqsim=INT(tadil/60)
   
   rem=INT(-taqsim*60+tadil)
   
   DIF=ALLTRIM(STR(taqsim))+":"+ALLTRIM(STR(rem))
   IF gresec<hassec
      sig="-1"
   ENDIF
   
   IF gresec=>hassec
      sig="+1"
   ENDIF
   
   
   m.diff=DIF
   SHOW GET m.diff
   m.sign=sig
   RETURN .F.
ENDIF

FUNCTION disp_pop
IF .T.
   DEFINE POPUP city_list;
      PROMPT FIELD city+country+LONGITUDE+SUBSTR(LO_DIR,1,1)+"    "+LATITUDE+SUBSTR(LA_DIR,1,1);
      SCROLL MARGIN;
      MESSAGE "PRESS THE FIRST LETTER OF THE LOCATION TO JUMP TO THE LOCATION INDEX.";
      COLOR N*/B,RGB(,,220,192,192,192)
   ON KEY LABEL f2 ACTIVATE POPUP CITY_LIST
   ON SELE POPUP city_list DO disp_city
   RETURN .T.
ENDIF

PROCEDURE disp_city
m.city=city
SHOW GET m.city
ON KEY
DEAC POPU city_list
RELE POPU city_list
RETURN

PROCEDURE POP
DEFINE WINDOW POPUP AT 2,2 SIZE 25,60;
   SHADOW PANEL MINIMIZE FLOAT GROW;
   TITLE "** INFORMATION FORM THE USER **";
   FOOTER "DESIGNED BY: MUHAMMAD REHAN QADRI";
   COLOR RGB (,,255,192,192,192);
   FILL FILE SYS(5)+SYS(2003)+"\PAPER13.BMP"
   DO bell2
ACTI WIND POPUP
MOVE WIND POPUP CENTER
ACTI POPU CITY_LIST REST

